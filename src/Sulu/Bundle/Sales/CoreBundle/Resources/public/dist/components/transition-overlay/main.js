define(["text!sulusalescore/components/transition-overlay/transition-overlay.html"],function(a){"use strict";var b={columns:["quantity","quantityUnit","name","account","address"],customerData:[],customerItemData:[],okCallback:null,transitionData:[]},c={MAX_CUSTOMER_LENGTH:20},d={overlayContainerClass:"transition-overlay-inner-container",transitionSelect:"#transition-select",customerSelect:"#customer-select",itemsTable:"#item-table"},e="sulu.transition-overlay.",f=function(){return g.call(this,"initialized")},g=function(a){var b=e;return this.options.instanceName&&(b+="."+this.options.instanceName),b+"."+a},h=function(){},i=function(){},j=function(b){var c,e,f;c=this.sandbox.dom.createElement('<div class="'+d.overlayContainerClass+'"></div>'),this.sandbox.dom.append(this.$el,c),f={data:b},e=this.sandbox.util.template(a,f),this.sandbox.start([{name:"overlay@husky",options:{el:c,container:this.$el,displayHeader:!1,openOnStart:!0,removeOnClose:!0,cssClass:"transition-overlay-container",instanceName:"transition",data:e,skin:"wide",okCallback:q.bind(this)}}]),this.sandbox.once("husky.overlay.transition.opened",p.bind(this))},k=function(a){var b=[];for(var c in a)b.push({id:c,name:this.sandbox.translate(a[c])});return b},l=function(a){for(var b,d=this.options.customerItemData,e=[],f=-1,g=d.length;++f<g&&(b=d[f],a&&a!=b.id||(this.sandbox.util.foreach(b.items,function(a){a.account={name:m(b.name,c.MAX_CUSTOMER_LENGTH),id:b.id}}),e=e.concat(b.items),!a)););return e},m=function(a,b){var c=a;return a.length>b+2&&(c=a.substring(0,b)+".."),c},n=function(a){this.sandbox.start([{name:"item-table@sulusalescore",options:{columns:this.options.columns,data:l.call(this,a),displayToolbars:!1,el:d.itemsTable,hasNestedItems:!0,instanceName:"transition",showPrice:!1,showItemCount:!1}}])},o=function(a){this.customerId=a,n.call(this,a)},p=function(){var a=k.call(this,this.options.transitionData),b=this.options.customerData;this.sandbox.start([{name:"select@husky",options:{data:a,el:d.transitionSelect,instanceName:"transition",preSelectedElements:[a[0].name],style:"action big"}},{name:"select@husky",options:{data:b,defaultLabel:this.sandbox.translate("public.all"),deselectCallback:o.bind(this),deselectField:this.sandbox.translate("public.all"),el:d.customerSelect,instanceName:"customer",selectCallback:o.bind(this)}}]),n.call(this)},q=function(){var a,b;this.sandbox.emit("husky.select.transition.get-checked",function(b){a=b[0]}),this.sandbox.emit("sulu.item-table.transition.get-data",function(a){b=a}),this.options.okCallback&&this.options.okCallback({transition:a,items:b})};return{initialize:function(){this.customerId=null,this.options=this.sandbox.util.extend({},b,this.options),h.call(this),i.call(this),this.render(),this.sandbox.emit(f.call(this))},render:function(){j.call(this)}}});